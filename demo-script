node
{
     stage('GitSCM')
    {
        git url: 'https://github.com/DevOps0110/petclinic.git'
    }

     stage('Initialize')
    {

        // jdk = tool name: 'jdk'
        // env.JAVA_HOME = "${jdk}"
        echo "jdk installation path is: ${JAVA_HOME}"
        sh "${JAVA_HOME}/bin/java -version"
    }

     stage('Build Stage')
    {
        def mvnHome = tool 'mvn'
        echo "Maven installation path is: ${M2_HOME}"
        sh "${M2_HOME}/bin/mvn -B verify"
    }

      stage('Sonar Analysis')
    {
        withSonarQubeEnv('sonar')
        {
            sh 'mvn clean package sonar:sonar'
            sh 'sleep 10'
        }
    }

    stage('Publish to Nexus')
    {
        sh 'mvn deploy:deploy-file -DgroupId=com.cicd -DartifactId=petclinic -Dversion=${BUILD_NUMBER} -DgeneratePom=true -Dpackaging=war -DrepositoryId=nexus-snapshots -Durl=http://54.202.213.82:8081/nexus/content/repositories/petclinic/  -Dfile=/root/.jenkins/workspace/Petclinic/target/petclinic.war'
    }
}
